<html>
<head>
<title>Adjustment Create Table</title>
<!-- 
Template path : Miscellaneus\AdjustmentAmounts.html
Author :
Purpose :
Referred Program : 
 Folder No:32
 Page No:3
-->

 <!$MGIF_Company52> 
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html;" charset="<!$MG_CharSet>">
 <!$MGELSE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html;"   charset="UTF-8" >
<!$MGENDIF>
<LINK rel="stylesheet" type="text/css" href="/English/GenScripts94/Def.css">
<!--<LINK rel="stylesheet" type="text/css" href="/English/GenScripts94/Rentpro.css">-->
<script language="javascript" src="/English/GenScripts94/GenFunctions.js"></script>
<script language="javascript" src="/English/GenScripts94/ModalPopups.js"></script>
<script language="JavaScript1.2" type="text/javascript">
var Folder_No =32;
var Page_No =3;
  var code_arr=new Array();
	var text_arr=new Array();
	var ReasonpayVat=new Array();
	var Reasonpayservice=new Array();
	var vatcode_arr=new Array();
  var	vattext_arr=new Array();
	var rowcount=0;
	var r_arr=new Array();
	var desc_arr=new Array();

	<!$MGIF_VatRecExist>
	<!$MGREPEAT>
	vatcode_arr[<!$MG_counter1>]="<!$MG_VatCode>";
	vattext_arr[<!$MG_counter1>]="<!$MG_VatText>";
	<!$MGENDREPEAT>
<!$MGENDIF>
<!-- Confirmation For Clear Button -->
function ClearData()
{
  with(document.forms[0])
  {
    Message=window.confirm("Do you really want to clear Data ?");
	if (Message)
       {
         reset();
		 cursor();
	 window.focus();
	 }

  }
}



function cursor()
{
  with(document.forms[0])
  {

	if(InvoiceCreated.value=='Y')
	{
	alert("Invoice Has been created");
	Proceed_BT.disabled=true;
	window.close();
	}
	else
	Proceed_BT.disabled=false; 
	FlagInvoice.value=0;
	/*BeforeVat1.value=0;
	VatAmount1.value=0;
	Total1.value=0;
	BeforeVat2.value=0;
	VatAmount2.value=0;
	Total2.value=0;
	BeforeVat3.value=0;
	VatAmount3.value=0;
	Total3.value=0;
	BeforeVat4.value=0;
	VatAmount4.value=0;
	Total4.value=0;
*/
	TotalBeforeVat.value=0;
	TotalVat.value=0;
    TotalAmount.value=0;
	
	
	if(CompanyCode.value!=110 && CompanyCode.value!=117)
	{
		document.getElementById("quotRow").style.display="none";
		document.getElementById("stampDutyRow").style.display="none";		
	}
	else
	{
		document.getElementById("quotRow").style.display="";
		document.getElementById("stampDutyRow").style.display="";	
	}
	
	if(CompanyCode.value!=108)
	{
		document.getElementById("quotRow").style.display="none";
		document.getElementById("analysisFeeRow").style.display="none";		
	}
	else
	{
		document.getElementById("quotRow").style.display="";
		document.getElementById("analysisFeeRow").style.display="";	
	}
	if(CompanyCode.value!=110 && CompanyCode.value!=117)
	{	 
		if(StampDutyInvoice.value=="Y")
		{
			document.getElementById("stampDutyRow").style.display="";		
			document.getElementById("quotRow").style.display="";
		}			
	}
	if( CompanyCode.value==108 && (AnalysisFeeAdjReason.value !='' && AnalysisFeeAdjReason.value !=0))
	{
	AddNew(1);
	}
	if( CompanyCode.value==89 && RentalDepInv.value=='Y')
	{
	AddNew(1);
	document.getElementById("Add").disabled="true";		
	reasonvatservice(document.getElementById('Vat1'),this,document.getElementById('BeforeVat1'  ),document.getElementById('ServiceFeePercent1' ),document.getElementById('VatAmount1'),document.getElementById('ServiceFeeAmount1'),document.getElementById('Total1'),document.getElementById('ReasonPayvat1'),document.getElementById('ReasonPayservice1'));	
	}
	if(CompanyCode.value==89)
	{
	document.getElementById("RentalDepInv_Theeb").style.display="";
	if(RentalDepInv.value=="Y")
	RentalDepInvVal.checked=true;
	else
	RentalDepInvVal.checked=false;
	}
	
	if(CompanyCode.value==112)
	{
	document.getElementById("invLable").style.display="";
	document.getElementById("invOthLable").style.display="none";
	
	if(InvoiceLableVal.value=="Y")
	InvoiceLable.checked=true;
	else
	InvoiceLable.checked=false;
	}
	else
	document.getElementById("invLable").style.display="none";
	document.getElementById("invOthLable").style.display="";
	
	if(StampDutyInvoice.value=="Y")
		{
			document.getElementById("Back_Bt").style.display="none";
			
			}
			
			
			
			if(CompanyCode.value !=89 )
			{
			
			Theeb1.style.display="none";
			
			}
	}
}



function CheckReasonEmpty(Reason)
{
	if(parseInt(Reason.value) == 0)
		{
		 alert("Please Enter a Reason");
		 Reason.focus();
	     return false;
		}
}

function check_form()
{
  with(document.forms[0])
  {
	/*if(OutBranch.value==0)    //for must fields: field is not " " , not "0"
			{
			alert("Please enter Branch !");
		    return false;
			}
			 if(!(NotEmptyField(AgreementNo.value)))
	   {
			if(!(NotEmptyField(DebitorCode.value)))
			{
			  alert("Please fill  data into: AgreementNo/DebitorCode Field");
			  return false;
			}
	    }
			if(Charge.value=="Customer")
			{
			 if(DebitorCode.value==0)
				{
				alert("Please enter Debitor !")
				return false;
				}
             }*/
  //first row check
    /*if(parseInt(Reason1.value)=='')     //for must fields: field is not " " , not "0"
      {
         alert("Please Enter a Reason");
		 Reason1.focus();	
         return false;
      }
	if(Reason1.value!='')
	  if(!(NotEmptyField(BeforeVat1.value)))     //for must fields: field is not " " , not "0"
      {
         alert("Please Enter Amount1");
		 BeforeVat1.focus();
         return false;
      }

	if(Reason2.value !='' && Reason2.value !='0')
	{
	if(!(NotEmptyField(BeforeVat2.value)))     //for must fields: field is not " " , not "0"
      {
         alert("Please Enter Amount2");
		 BeforeVat2.focus();
         return false;
      }
		}

   if(Reason3.value != '' && Reason3.value != '0')
	{	
	
	if(!(NotEmptyField(BeforeVat3.value)))     //for must fields: field is not " " , not "0"
      {
         alert("Please Enter Amount3");
		 BeforeVat3.focus();
         return false;
      }
	 	
    }
	 if(Reason4.value != '' && Reason4.value != '0')
	{
	if(!(NotEmptyField(BeforeVat4.value)))     //for must fields: field is not " " , not "0"
      {
         alert("Please Enter Amount4");
		 BeforeVat4.focus();
         return false;
      }
	
		
	}
	
	BeforeVat1.value=trim(BeforeVat1.value);
	BeforeVat2.value=trim(BeforeVat2.value);
	BeforeVat3.value=trim(BeforeVat3.value);
  BeforeVat4.value=trim(BeforeVat4.value);
	//Abhi Valeus are assigned to 0 so that Nan Problem of javacript during addition will avoided. 
	if(BeforeVat1.value=='')
		BeforeVat1.value=0;
	if(BeforeVat2.value=='')
		BeforeVat2.value=0;
	if(BeforeVat3.value=='')
		BeforeVat3.value=0;
	if(BeforeVat4.value=='')
		BeforeVat4.value=0;		*/		
		
		if(parseFloat(TotalAmount.value)<0 && CompanyCode.value==89 && RentalDepInv.value=='Y')
		{
		
		 alert("Please do not enter negative amount for Rental Deposit Invoice");
		 BeforeVat1.value=0;
		 BeforeVat1.focus();
		 calculatevat(document.getElementById('Vat1' ),document.getElementById('Reason1'),document.getElementById('BeforeVat1'),document.getElementById('ServiceFeePercent1'),document.getElementById('VatAmount1'),document.getElementById('ServiceFeeAmount1'),document.getElementById('Total1' ),document.getElementById('AmtIncVat1'),0);
         return false;
		}

			if(CompanyCode.value==112 && TotalVat.value !=0 && TotalBeforeVat.value !=0)
		{
			var xml1;  
			var urlOc = '/Magic94Scripts/mgrqispi94.dll?appname=RentProWeb&prgName=[X]TaxInvoiceValidation&Arguments=-A';	
			var xmltemp = new ActiveXObject("Msxml2.XMLHTTP.3.0");
			xmltemp.open("GET",urlOc, false);			 
			xmltemp.send();			
			xml1 = xmltemp.responseXML;
			resultNode = xml1.getElementsByTagName('Root').item(0);      
			if(resultNode)
			{			  
				if(resultNode.getAttribute('TaxInvErrorWarning') == 'W' || resultNode.getAttribute('TaxInvErrorWarning') == 'E')
				{
					if(resultNode.getAttribute('Count') <=0)
					{
						if(!(confirm("Tax sequence does not exist,Do you want to proceed?")))	
						return false;
					}
					else
					{
					if(!(confirm(resultNode.getAttribute('Count') +' '+"tax number remaining,Do you want to proceed?")))	
					return false;
				}
			}
		}
		}

		
					Make_DisableButton(true);
					InvoiceCreated.value='Y';
 							  if(PassAuthYN.value == 'Y')
								{								 
        				 if(CompanyCode.value==102)
				     {
                     UserPasswordValidation('Y');
					 }
					 else
					 {
					 UserPasswordValidation('N');
					 }
								}
								else
								{							
        				WhindowSubmit()			
								} 
 
// var loc="/Magic94Scripts/mgrqispi94.dll?APPNAME=RentProWeb&PRGNAME=CheckforAdjustmentCredit&ARGUMENTS=-A"+TotalBeforeVat.value+",-A"+Currency.value+",-A"+AgreementNo.value+",-A"+InvNo.value;
	//				document.all.frm_page.src=loc;   
  }
}


function WhindowSubmit()
{
with(document.forms[0])
{
    if(!validateRow())
		return false;	
		tbl=document.getElementById("DetailsTable");
    rows=tbl.tBodies[0].rows;
								 
     if(rows.length<2)
      {
		  alert("Please Enter Details !");
		  Make_DisableButton(false);
      return false;
      }
	  var amtEnterted=0;	
	 if(CompanyCode.value==110 || CompanyCode.value==117)
	 {
	  for(i=1;i<rows.length;i++)
			{							
				amtEnterted=parseFloat(rows[i].childNodes[3].firstChild.value)+parseFloat(amtEnterted);
						
			}			
			  if(StanpDutyInv.value=='Y' && parseFloat(StampDutyAmt.value)!=parseFloat(amtEnterted))
			  {
				alert("Total Adjustment Amount Should Equal To Stamp Duty Amount")
				Proceed_BT.disabled=false;
				return false;
			  }	
		}
			 if(CompanyCode.value==126 )
	 {
	 var stmp_amt=isNaN(parseFloat(StampDutyAmt.value))?0:parseFloat(StampDutyAmt.value)+ isNaN(parseFloat(Process_Fee.value))?0:parseFloat(Process_Fee.value);
	
	 if(StampDutyInvoice.value=='Y' && parseFloat(stmp_amt)!=0)
			{
	  for(i=1;i<rows.length;i++)
			{						
				amtEnterted=parseFloat(rows[i].childNodes[3].firstChild.value)+parseFloat(amtEnterted);
						
			}	
			
			  if(StanpDutyInv.value=='Y' && parseFloat(stmp_amt)!=parseFloat(amtEnterted))
			  {
				alert("Total Adjustment Amount Should Equal To Stamp Duty Plus Processing Fee Amount")
				Proceed_BT.disabled=false;
				return false;
			  }
             }			  
		}
		if(CompanyCode.value!=110 && CompanyCode.value!=117 && CompanyCode.value!=126)
		{
			if(StampDutyInvoice.value=='Y' && parseFloat(StampDutyAmt.value)!=0)
			{
				for(i=1;i<rows.length;i++)
				{							
					amtEnterted=parseFloat(rows[i].childNodes[3].firstChild.value)+parseFloat(amtEnterted);
							
				}			
				if(parseFloat(StampDutyAmt.value)!=parseFloat(amtEnterted))
				{
					alert("Total Adjustment Amount Should Equal To Stamp Duty Amount")
					Proceed_BT.disabled=false;
					return false;
				}
			}	
		}
		  var amtEnterted1=0;	
	 if(CompanyCode.value==108)
	 {
	  for(i=1;i<rows.length;i++)
			{							
				amtEnterted1=parseFloat(rows[i].childNodes[3].firstChild.value)+parseFloat(amtEnterted1);
						
			}			
			  if(AnalysisFeeInv.value=='Y' && parseFloat(AnalysisFeeAmt.value)!=parseFloat(amtEnterted1))
			  {
				alert("Total Adjustment Amount Should Equal To Analysis Fee Amount")
				Proceed_BT.disabled=false;
				return false;
			  }	
		}
		
		if(UpdateItemXml())
		{
		  //alert(DetailLinesBlob.value)
		 var NewDate= new Date();
					var DD   =   NewDate.getDate()
					DD= ((DD < 10) ? "0" : "") + DD;
					var MM   =   NewDate.getMonth()+1
					MM= ((MM < 10) ? "0" : "") + MM
					var YYYY =  NewDate.getFullYear()
					CurrDate.value =  DD+'/'+MM+'/'+YYYY;
			if(!CheckFiscalPeriod(CurrDate))
				{
					//Make_DisableButton(false);
					return false;
				}
		  submit();
		}


}
}
/*Added this function for the user and password validation as sujjested by abhijeet-priya   */
function Make_DisableButton(flag)
{
 				 with (document.forms[0])
				 {
				 	Proceed_BT.disabled=flag;				 
				 }
}





function buildReasoncombo(cmbobj)
{
  with(document.forms[0])
  {

    	<!$MGREPEAT>

  	ReasonpayVat[<!$MG_counter>]="<!$MG_ReasonPayVat>";
  	Reasonpayservice[<!$MG_counter>]="<!$MG_ReasonPayService>";
  
  <!$MGENDREPEAT>
  code_arr = document.getElementById("DummyReasonCombo").options;
  
  //code_arr[0]="";
  	text_arr[0]="";
  	
  	
  	
  	
  	//cmbobj.options.length=code_arr.length;
  	for(i=0;i<code_arr.length;i++)
  	{
  		cmbobj.options[i]=new Option(i,'');
  	  
    }
  	
  	
  		for(i=1;i<code_arr.length;i++)
  	{
  		cmbobj.options[i].value='';
  	  cmbobj.options[i].text='';
    }
    var j=1;
    	cmbobj.options[0].value='';
    	cmbobj.options[0].text='';
    
    		for(i=1;i<code_arr.length;i++)
    	{
    	
    	cmbobj.options[j].value=code_arr[i].value;
    	cmbobj.options[j].text=code_arr[i].text;
    	j++;
    	} 
  }
}

function reasonvatservice(vatbobj,reasonobj,beforevatobj,serviceobj,vatamountobj,servicamountobj,totalobj,reasonpayvatobj,reasonpayserviceobj,AmtIncVat_1)
{
  with(document.forms[0])
  {
  for(i=0;i<code_arr.length;i++)
  	{
      	if(reasonobj.value==code_arr[i])
      	{
      	reasonpayvatobj.value=ReasonpayVat[i];
  			
      	reasonpayserviceobj.value=Reasonpayservice[i];
      	}
   }
  	
  	buildvatcombo(vatbobj,reasonobj,beforevatobj,serviceobj,vatamountobj,servicamountobj,totalobj,reasonpayvatobj,reasonpayserviceobj,AmtIncVat_1);
  }
}

function buildvatcombo(vatobj,reasonobj,beforevatobj,serviceobj,vatamountobj,servicamountobj,totalobj,reasonpayvatobj,reasonpayserviceobj,AmtIncVat_1)
{
  with(document.forms[0])
  {
  		if(reasonobj.value=='')
  		{
  		beforevatobj.value=0;
  		beforevatobj.disabled=true;
  		}
  		else
   		beforevatobj.disabled=false;		
		if((AgrVat.value=='') ||(parseFloat(AgrVat.value)==0)|| (reasonpayvatobj.value=='N'))
      	{
			if(InvoiceType.value == 'B' && InvSubType.value == 7 && reasonpayvatobj.value == 'Y')
			{
				vatcode_arr[0]=0;
				vattext_arr[0]="0%";
				vatobj.options.length=vatcode_arr.length;
					
				for(i=0;i<=vatcode_arr.length;i++)
				{
				vatobj.options[i].value=vatcode_arr[i];
				vatobj.options[i].text=vattext_arr[i];
				}
			}
			else
			{
				vatobj.options.length=1;
				vatobj.options[0].value=0;
				vatobj.options[0].text="0%";
			}
      	}
      	else if(ErrorWarningFlag.value=='E')
      	{
			vatobj.options.length=1;
			vatobj.options[0].value=AgrVat.value;
			vatobj.options[0].text=AgrVat.value+'%';
		}
		else
      	{
			vatcode_arr[0]=0;
			vattext_arr[0]="0%";
			vatobj.options.length=vatcode_arr.length;
				
			for(i=0;i<=vatcode_arr.length;i++)
			{
			vatobj.options[i].value=vatcode_arr[i];
			vatobj.options[i].text=vattext_arr[i];
			}
			//vatobj.value=AgrVat.value;
  			
  			//vatobj.options[0].text=AgrVat.value;
      	}
  	 buildSerivcecombo(serviceobj,reasonpayserviceobj);
   calculatevat(vatobj,reasonobj,beforevatobj,serviceobj,vatamountobj,servicamountobj,totalobj,AmtIncVat_1,0);
  	
  }
}




function calculateAmounts(AmtInclVatobj,vatobj,beforevatobj,serviceobj,vatamountobj,servicamountobj,totalobj,tempVar)
{
    with(document.forms[0])
    {
      var vatamt;
      var beforevatamt;
      var Serviceamt;
      var commafind;
      var vatpercent;
      var servicepercent;
      commafind = DecimalSeparator.value;
      commafind = commafind.indexOf(","); 
      vatpercent=vatobj.value;
      servicepercent=serviceobj.value;
        if(commafind==-1)
        {
        }
        else
        {
		AmtInclVatobj.value=isNaN(parseFloat(AmtInclVatobj.value))?0:parseFloat(AmtInclVatobj.value)
		AmtInclVatobj.value=AmtInclVatobj.value.replace(/,/g, '.');
        beforevatobj.value=isNaN(parseFloat(beforevatobj.value))?0:parseFloat(beforevatobj.value);
        beforevatobj.value=beforevatobj.value.replace(/,/g, '.');
        vatpercent=vatpercent.replace(/,/g, '.');
        servicepercent=servicepercent.replace(/,/g, '.');
        }
	if(tempVar==0)
	{
		AmtInclVatobj.value=totalobj.value;
	}
	else
	{
	 beforevatamt=AmtInclVatobj.value/(1+vatpercent/100);
	
	  beforevatobj.value=(beforevatamt.toFixed(DecimalFormat.value));
      vatamt=parseFloat(beforevatobj.value*vatpercent)/100;
	        vatamountobj.value=(vatamt.toFixed(DecimalFormat.value));
      //Serviceamt=(beforevatobj.value*servicepercent)/100;
    //  servicamountobj.value=(Serviceamt.toFixed(DecimalFormat.value));
    
      if(beforevatobj.value=='')
      {beforevatobj.value=0;
      }
    
    
      totalobj.value=parseFloat(beforevatobj.value)+parseFloat(vatamountobj.value)+parseFloat(servicamountobj.value);
      totalobj.value=parseFloat(totalobj.value).toFixed(DecimalFormat.value);
	  }
	  CalculateTotal();
	  }}
function calculatevat(vatobj,reasonobj,beforevatobj,serviceobj,vatamountobj,servicamountobj,totalobj,AmtInclVatobj_1,tempVar)
{
    with(document.forms[0])
    {

      var vatamt;
      var Serviceamt;
      var commafind;
      var vatpercent;
      var servicepercent;
      commafind = DecimalSeparator.value;
      commafind = commafind.indexOf(","); 
      vatpercent=vatobj.value;
      servicepercent=serviceobj.value;
        if(commafind==-1)
        {
        }
        else
        {
        beforevatobj.value=beforevatobj.value.replace(/,/g, '.');
		
        vatpercent=vatpercent.replace(/,/g, '.');
        servicepercent=servicepercent.replace(/,/g, '.');
        }
		
      vatamt=parseFloat(beforevatobj.value*vatpercent)/100;
      vatamountobj.value=(vatamt.toFixed(DecimalFormat.value));
      Serviceamt=(beforevatobj.value*servicepercent)/100;
      servicamountobj.value=(Serviceamt.toFixed(DecimalFormat.value));
    
      if(beforevatobj.value=='')
      {beforevatobj.value=0;
      }
    
    
      totalobj.value=parseFloat(beforevatobj.value)+parseFloat(vatamountobj.value)+parseFloat(servicamountobj.value);
      totalobj.value=parseFloat(totalobj.value).toFixed(DecimalFormat.value);
    
    //TotalBeforeVat.value=parseFloat(TotalBeforeVat.value)+parseFloat(beforevatobj.value)
    CalculateTotal();
	 if(CompanyCode.value==89)	
               {
	calculateAmounts(document.getElementById('AmtIncVat' + rowcount),vatobj,beforevatobj,serviceobj,vatamountobj,servicamountobj,totalobj,tempVar)
	}

    
    /*if(commafind==-1)
    {
    }
    else
    {
    BeforeVat1.value=BeforeVat1.value.replace(/,/g, '.');
    BeforeVat2.value=BeforeVat2.value.replace(/,/g, '.');
    BeforeVat3.value=BeforeVat3.value.replace(/,/g, '.');
    BeforeVat4.value=BeforeVat4.value.replace(/,/g, '.');
    }
    TotalBeforeVat.value=parseFloat(BeforeVat1.value)+parseFloat(BeforeVat2.value)+parseFloat(BeforeVat3.value)+parseFloat(BeforeVat4.value);
    //TotalBeforeVat.value=TotalBeforeVat.toFixed(2);
    if(commafind==-1)
    {
    }
    else
    {
    BeforeVat1.value=BeforeVat1.value.replace('.', ',');
    BeforeVat2.value=BeforeVat2.value.replace('.', ',');
    BeforeVat3.value=BeforeVat3.value.replace('.', ',');
    BeforeVat4.value=BeforeVat4.value.replace('.', ',');
    
    ServiceFeeAmount1.value=ServiceFeeAmount1.value.replace(/,/g, '.');
    ServiceFeeAmount2.value=ServiceFeeAmount2.value.replace(/,/g, '.');
    ServiceFeeAmount3.value=ServiceFeeAmount3.value.replace(/,/g, '.');
    ServiceFeeAmount4.value=ServiceFeeAmount4.value.replace(/,/g, '.');
    }
    TotalService.value=parseFloat(ServiceFeeAmount1.value)+parseFloat(ServiceFeeAmount2.value)+parseFloat(ServiceFeeAmount3.value)+parseFloat(ServiceFeeAmount4.value);
    if(commafind==-1)
    {
    }
    else
    {
    ServiceFeeAmount1.value=ServiceFeeAmount1.value.replace('.', ',');
    ServiceFeeAmount2.value=ServiceFeeAmount2.value.replace('.', ',');
    ServiceFeeAmount3.value=ServiceFeeAmount3.value.replace('.', ',');
    ServiceFeeAmount4.value=ServiceFeeAmount4.value.replace('.', ',');
    
    VatAmount1.value=VatAmount1.value.replace(/,/g, '.');
    VatAmount2.value=VatAmount2.value.replace(/,/g, '.');
    VatAmount3.value=VatAmount3.value.replace(/,/g, '.');
    VatAmount4.value=VatAmount4.value.replace(/,/g, '.');
    }
    TotalVat.value=parseFloat(VatAmount1.value)+parseFloat(VatAmount2.value)+parseFloat(VatAmount3.value)+parseFloat(VatAmount4.value);
    if(commafind==-1)
    {
    }
    else
    {
    VatAmount1.value=VatAmount1.value.replace('.', ',');
    VatAmount2.value=VatAmount2.value.replace('.', ',');
    VatAmount3.value=VatAmount3.value.replace('.', ',');
    VatAmount4.value=VatAmount4.value.replace('.', ',');
    
    Total1.value=Total1.value.replace(/,/g, '.');
    Total2.value=Total2.value.replace(/,/g, '.');
    Total3.value=Total3.value.replace(/,/g, '.');
    Total4.value=Total4.value.replace(/,/g, '.');
    }
    TotalAmount.value=parseFloat(Total1.value)+parseFloat(Total2.value)+parseFloat(Total3.value)+parseFloat(Total4.value);
    if(commafind==-1)
    {
    }
    else
    {
    Total1.value=Total1.value.replace('.', ',');
    Total2.value=Total2.value.replace('.', ',');
    Total3.value=Total3.value.replace('.', ',');
    Total4.value=Total4.value.replace('.', ',');
    }*/
		
 			//20130221 SNEHA: changes done for decimal separator comma		
      if(commafind==-1)
      {
      }
      else
      {
      beforevatobj.value=beforevatobj.value.replace('.', ',');
      vatamountobj.value=vatamountobj.value.replace('.', ',');
      servicamountobj.value=servicamountobj.value.replace('.', ',');
      totalobj.value=totalobj.value.replace('.', ',');
      
      TotalBeforeVat.value=TotalBeforeVat.value.replace('.', ',');
      TotalService.value=TotalService.value.replace('.', ',');
      TotalVat.value=TotalVat.value.replace('.', ',');
      TotalAmount.value=TotalAmount.value.replace('.', ',');
      }
    }
}

function CalculateTotal()
{
    with(document.forms[0])
    {
		
  var amtBefVat=0;
  var serviceAmt=0;
  var vatAmt=0;
  var totalAmt=0;
  var commafind;
  commafind = DecimalSeparator.value;
  commafind = commafind.indexOf(","); 
			
		    TotalBeforeVat.value=0;
             TotalService.value=0;
          TotalVat.value=0;
            TotalAmount.value=0;
          					
          			tbl=document.getElementById("DetailsTable");
                	         rows=tbl.tBodies[0].rows;
      					 
      			for(i=1;i<rows.length;i++)
             
              { cells=rows[i].cells;	
				 var rowid_var=rows[i].getAttribute("rowid");    
          			//20130221 SNEHA: changes done for decimal separator comma 
                if(commafind==-1 || (CountryISOCOde.value=="DE" && CompanyFormat.value==135))
                {
                amtBefVat=document.getElementById("BeforeVat"+rowid_var).value;
                serviceAmt=document.getElementById("ServiceFeeAmount"+rowid_var).value;
                vatAmt=document.getElementById("VatAmount"+rowid_var).value;
                totalAmt=document.getElementById("Total"+rowid_var).value;								
                }
                else
                {
                /*amtBefVat=document.getElementById("BeforeVat"+rowid_var).value.replace(/,/g, '.');;
                serviceAmt=document.getElementById("ServiceFeeAmount"+rowid_var).value.replace(/,/g, '.');;
                vatAmt=document.getElementById("VatAmount"+rowid_var)value.replace(/,/g, '.');;
                totalAmt=document.getElementById("Total"+rowid_var).value.replace(/,/g, '.');;								*/
              	}
			
                TotalBeforeVat.value=parseFloat(TotalBeforeVat.value)+parseFloat(amtBefVat);
  							TotalService.value=parseFloat(TotalService.value)+parseFloat(serviceAmt);
  							TotalVat.value=parseFloat(TotalVat.value)+parseFloat(vatAmt);
  							TotalAmount.value=parseFloat(TotalAmount.value)+parseFloat(totalAmt);
               }
				    TotalBeforeVat.value= parseFloat(TotalBeforeVat.value).toFixed(DecimalFormat.value);
				    TotalService.value=parseFloat(TotalService.value).toFixed(DecimalFormat.value);
				    TotalVat.value=parseFloat(TotalVat.value).toFixed(DecimalFormat.value); 
				   TotalAmount.value=parseFloat(TotalAmount.value).toFixed(DecimalFormat.value);
    }
}

function buildSerivcecombo(serviceobj,reasonpayserviceobj)
{
with(document.forms[0])
{
		  if((AgrService.value=='') ||(AgrService.value==0)||(reasonpayserviceobj.value=='N'))
    	{
    	serviceobj.options.length=1;
    	serviceobj.options[0].value=0;
    	serviceobj.options[0].text="0%";
    	}
    	else
    	{
			serviceobj.options.length=2;
    	serviceobj.options[0].value=0;
    	serviceobj.options[0].text="0%";
			serviceobj.options[1].value=DefaultService.value;
    	serviceobj.options[1].text=DefaultService.value+'%';
		 	serviceobj.value=DefaultService.value;
    	}
}
}

function ChangeVat(vatobj,reasonobj,beforevatobj,serviceobj,vatamtobj,serviceamtobj,totalobj,AmtInclVatobj_1)
{

with(document.forms[0])
{

if((ErrorWarningFlag.value=='W')&&(AgrVat.value!=vatobj.value))
{
if(!confirm("Agreement Vat % Is Not Matching With Selected Vat %,Do You Want To Proceed ?"))
vatobj.focus();
}
calculatevat(vatobj,reasonobj,beforevatobj,serviceobj,vatamtobj,serviceamtobj,totalobj,AmtInclVatobj_1,0);
}
}


function ChargeVatChauff(Vatobj)
{
with(document.forms[0])
 {
 if(Vatobj && Adjtype.value=='L')
   {
	 if((AgreementNo.value=='') || (InvNo.value==''))
	   {
       if((ChargeVatYN.value=='N') && (AgrVat.value==0))
         {
			 Vatobj.disabled=true;
      	/* Vat1.disabled=true;
      	 Vat2.disabled=true;
      	 Vat3.disabled=true;
      	 Vat4.disabled=true;*/
      	 }
       else
         {	
			 Vatobj.disabled=false;
      	/* Vat1.disabled=false;
      	 Vat2.disabled=false;
      	 Vat3.disabled=false;
      	 Vat4.disabled=false;*/
      	 }
		 }	 
   } 
   }
}

function STaxRentalComp()
{
with(document.forms[0])
 {
 if(CompanyCode.value==56)
   {
	 ChargeSerTaxRental();
	 }
 }
} 
 
function ChargeSerTaxRental()
{
with(document.forms[0])
 {
 if(Adjtype.value=='E')
   {
	 if((AgreementNo.value=='') || (InvNo.value==''))
	   {
       if(AgrService.value==0)
         {
      	 ServiceFeePercent1.disabled=true;
      	 ServiceFeePercent2.disabled=true;
      	 ServiceFeePercent3.disabled=true;
      	 ServiceFeePercent4.disabled=true;
      	 }
       else
         {	 
      	 ServiceFeePercent1.disabled=false;
      	 ServiceFeePercent2.disabled=false;
      	 ServiceFeePercent3.disabled=false;
      	 ServiceFeePercent4.disabled=false;
      	 }
		 }	 
   } 
 }
}



<!----Dyanamic starts-->
function validateRow()
{
 	tbl=document.getElementById("DetailsTable");
	rows=tbl.tBodies[0].rows;										
	rowscount=tbl.tBodies[0].rows.length;	
	with(document.forms[0])
 {  
	
       	for(i=1;i<rowscount;i++)
      	{
        	 cells1=rows[i].cells;	
			 var rowid_var=rows[i].getAttribute("rowid");
        	 if(document.getElementById("Reason"+rowid_var).value=="" ||document.getElementById("Reason"+rowid_var).value==0)
        	 {
        	 	alert("Please Enter Reason");
        		document.getElementById("Reason"+rowid_var).focus();
				Make_DisableButton(false);
        		return false; 
        	 }	
				 
        	 if(!ValidateBeforeVat(document.getElementById("BeforeVat"+rowid_var).value)||document.getElementById("BeforeVat"+rowid_var).value==0)
			 {
			 alert("Please Enter Before Vat Amount");
			 document.getElementById("BeforeVat"+rowid_var).focus();
			 Make_DisableButton(false);
			 return false; 
			 }
 
		}

	
      	}
			return true;
}
function ValidateBeforeVat(Before)
{
    with(document.forms[0])
    {
	if(DecimalSeparator.value == ',' && CountryISOCOde.value=="DE" && CompanyFormat.value==135)
	{
		var ex1 = /^\-[0-9]+\,?[0-9]*$/;
		var ex2 = /^[0-9]+\,?[0-9]*$/;
	}
	else
	{
	 var ex1 = /^\-[0-9]+\.?[0-9]*$/;
	  var ex2 = /^[0-9]+\.?[0-9]*$/;
	}
		if(ex1.test(Before)||ex2.test(Before))
		{
			return true;
		}
			else
		{
			alert("Please Enter Decimal Value In Proper Format");
			return false;
		}
	}
}

function validateReason()
{
tbl=document.getElementById("DetailsTable");
	rows=tbl.tBodies[0].rows;										
	rowscount=tbl.tBodies[0].rows.length;	
	with(document.forms[0])
 {  
	
       	for(i=1;i<rowscount;i++)
      	{
        	 cells1=rows[i].cells;	
				 var rowid_var=rows[i].getAttribute("rowid");
                  for(j=i+1;j<rowscount;j++)
                   	{
        	          cells2=rows[j].cells;	 
      				  var rowid_var1=rows[j].getAttribute("rowid");
      				     if(document.getElementById("Reason"+rowid_var).value==document.getElementById("Reason"+rowid_var1).value)
                    	  {
                    	 	alert("This Reason Is Already Added,Please Enter Another Reason");
								document.getElementById("Reason"+rowid_var1).value="";
                    		document.getElementById("Reason"+rowid_var1).focus();
                    		return false; 
                            }
					   	 }	
				} 
}
}

function AddNew(calledfrom)
	{
	with(document.forms[0])
	    {
			if(!validateRow())
		return false;		
			CreateTableRow(calledfrom);
	
	}
	
	}
	
	function CreateTableRow(calledfrom)
{
    with(document.forms[0])
 
    {	
		  tbl=document.getElementById("DetailsTable");
     rows=tbl.tBodies[0].rows;
	   rowscount=tbl.tBodies[0].rows.length;
	
	
    	if(rowscount<2)
    	{
    	 lastRow=1;
    	}
    	else
    	{
    	 cells = rows[rowscount-1].cells;
    	 var dynamic_id=rows[rowscount-1].getAttribute("rowid");	
lastRow= parseInt(dynamic_id)+1;
    	}
	
	
	
    	         tr=tbl.tBodies[0].insertRow(rowscount);
    	         tr.id=lastRow;
				 tr.setAttribute("rowid",lastRow);
              	 td = document.createElement('TD');
              	 text = document.createTextNode(lastRow);
              	 td.appendChild(text);
              	 tr.appendChild(td);
	//1st Cell End

	
        		
              	td = document.createElement('TD');
              	text = document.createElement('select');
                text.setAttribute('className', 'textInputField_CmbLG' );		
              	text.id="Reason"+lastRow;
              	text.name="Reason"+lastRow;
    			buildReasoncombo(text);
    			td.appendChild(text);
              	tr.appendChild(td);	
                 if(calledfrom==1 && CompanyCode.value==108)	
               {				 
			  	text.value=AnalysisFeeAdjReason.value;
				text.disabled=true;
				}
				if(calledfrom==1 && CompanyCode.value==89)	
               {				 
			  	text.value=82;
				text.disabled=true;
				}
				if(CompanyCode.value!=82)	
						    {	
    			validateReason();
				}
                ReasonDynamicFunctions(text,lastRow);					
    				
    					
					td = document.createElement('TD');
            	text = document.createElement('input');
            	text.setAttribute("className",'textInputFieldLr');
            	text.setAttribute("class",'textInputFieldLr');
            	text.id="Remark"+lastRow;
            	text.name="Remark"+lastRow;   
      			text.maxLength="100";
      			text.value="";
				if(CompanyCode.value==55)	
					text.style.width="200px"  
				if(calledfrom==1 && CompanyCode.value==108)	
               {				 
			  	text.value='Analysis Fee';
				}
      		   	td.appendChild(text);
      	        tr.appendChild(td);       	
				
				var td = document.createElement('TD');
            	text = document.createElement('input');
            	text.value=0;
            	text.setAttribute("className",'textInputFieldMd');				
            	text.setAttribute("class",'textInputFieldMd');				
            	text.id="AmtIncVat"+lastRow;
            	text.name="AmtIncVat"+lastRow;
				text.maxLength="10";
				
            	td.appendChild(text);
            	tr.appendChild(td);		
					CalculateAmtIncDynamicFunctions2(text,lastRow,1)
			 if(CompanyCode.value!=89)	
               {				 
			  	td.style.display="none";
				}
		
      			var td = document.createElement('TD');
            	text = document.createElement('input');
            	text.value=0;
            	text.setAttribute("className",'textInputFieldMd');				
            	text.setAttribute("class",'textInputFieldMd');				
            	text.id="BeforeVat"+lastRow;
            	text.name="BeforeVat"+lastRow;
				text.maxLength="10";
				 if(calledfrom==1 && CompanyCode.value==108)	
               {				 
			  	text.value=AnalysisFeeAmt.value;
				}
            	td.appendChild(text);
            	tr.appendChild(td);		
					CalculateTotalDynamicFunctions(text,lastRow,0)
					
							
      				
      			td = document.createElement('TD');
            	text = document.createElement('select');
            	text.value="";
            	text.setAttribute("className",'textInputField_CmbMd');				
            	text.setAttribute("class",'textInputField_CmbMd');				
            	text.id="ServiceFeePercent"+lastRow;
            	text.name="ServiceFeePercent"+lastRow; 	
					text.options[0] = new Option('0%','0');
					td.appendChild(text);
            	tr.appendChild(td);		
					CalculateTotalDynamicFunctions2(text,lastRow)
			
			
                td = document.createElement('TD');
            	text = document.createElement('input');
            	text.value="";
            	text.setAttribute("className",'readOnly_textInputFieldMd');				
            	text.setAttribute("class",'readOnly_textInputFieldMd');				
            	text.id="ServiceFeeAmount"+lastRow;
            	text.name="ServiceFeeAmount"+lastRow;
      		    text.readOnly=true;
            	td.appendChild(text);
            	tr.appendChild(td);		
					
					td = document.createElement('TD');
            	text = document.createElement('select');
            	text.value="";
            	text.setAttribute("className",'textInputField_CmbMd');				
            	text.setAttribute("class",'textInputField_CmbMd');				
            	text.id="Vat"+lastRow;
            	text.name="Vat"+lastRow; 	
					<!$MGIF_ZeroPercentDisplay>
                text.options[0] = new Option('0%','0');
                <!$MGENDIF>
					td.appendChild(text);
            	tr.appendChild(td);		
					ChargeVatChauff(text);
					CalculateTotalDynamicFunctions1(text,lastRow)
			
			
					
                td = document.createElement('TD');
            	text = document.createElement('input');
            	text.value="";
            	text.setAttribute("className",'readOnly_textInputFieldMd');				
            	text.setAttribute("class",'readOnly_textInputFieldMd');				
            	text.id="VatAmount"+lastRow;
            	text.name="VatAmount"+lastRow;
      		    text.readOnly=true;
            	td.appendChild(text);
            	tr.appendChild(td);		
					
					 td = document.createElement('TD');
            	text = document.createElement('input');
            	text.value="";
            	text.setAttribute("className",'readOnly_textInputFieldMd');				
            	text.setAttribute("class",'readOnly_textInputFieldMd');				
            	text.id="Total"+lastRow;
            	text.name="Total"+lastRow;
      		    text.readOnly=true;
            	td.appendChild(text);
            	tr.appendChild(td);		
		 
  				td = document.createElement('TD');
  				td.align="center";
				if(calledfrom!=1 || CompanyCode.value!=108)	
				{
  				text=createimgnode(lastRow);
				}
				else
				text=document.createElement('')
        	    td.appendChild(text);
        	    tr.appendChild(td);
			        td = document.createElement('TD');
            	
					text = document.createElement('input');
					text.setAttribute('type', 'hidden');
            	text.value="";
            	text.setAttribute("className",'readOnly_textInputFieldMd');				
            	text.setAttribute("class",'readOnly_textInputFieldMd');				
            	text.id="ReasonPayvat"+lastRow;
            	text.name="ReasonPayvat"+lastRow;
      		    text.readOnly=true;
            	td.appendChild(text);
				td.style.display = "none";
            	tr.appendChild(td);		
			
			        td = document.createElement('TD');
            	text = document.createElement('input');
					text.setAttribute('type', 'hidden');
            	text.value="";
            	text.setAttribute("className",'readOnly_textInputFieldMd');				
            	text.setAttribute("class",'readOnly_textInputFieldMd');				
            	text.id="ReasonPayservice"+lastRow;
            	text.name="ReasonPayservice"+lastRow;
      		    text.readOnly=true;
            	td.appendChild(text);
				td.style.display = "none";
            	tr.appendChild(td);		
				
				if(calledfrom==1 && CompanyCode.value==108)	
               {
			   reasonvatservice(document.getElementById('Vat' + lastRow),document.getElementById('Reason' + lastRow),document.getElementById('BeforeVat' + lastRow),document.getElementById('ServiceFeePercent' + lastRow),document.getElementById('VatAmount' + lastRow),document.getElementById('ServiceFeeAmount' + lastRow),document.getElementById('Total' + lastRow),document.getElementById('ReasonPayvat' + lastRow),document.getElementById('ReasonPayservice' + lastRow),document.getElementById('AmtIncVat' + lastRow));	
			   
				 calculatevat(document.getElementById('Vat' + lastRow),document.getElementById('Reason' + lastRow),document.getElementById('BeforeVat' + lastRow),document.getElementById('ServiceFeePercent' +lastRow),document.getElementById('VatAmount' + lastRow),document.getElementById('ServiceFeeAmount' +lastRow),document.getElementById('Total' + lastRow),document.getElementById('AmtIncVat' + lastRow),0)
              }
 
 }
}
function createimgnode(lrw1)
{
text=document.createElement('img');
				text.src='/English/Images94/QuickAccess/delete.gif'
      
				text.id="DelDelete"+lrw1;
      	text.name="DelDelete"+lrw1; 
				  text.alt='Delete';
					
					 text.onclick=function(){Deleterow(lrw1);}
					 return text;
					 //{delTableRow(lastRow);}	
}




function Deleterow(row)
{
    with(document.forms[0])
    { if(confirm ("Are you sure you want to delete this item"))
		{tb=document.getElementById("DetailsTable");
      
			
			 tb.tBodies[0].removeChild(document.getElementById(row));
			CalculateTotal();
           
			
    }
 }
}

  function CalculateTotalDynamicFunctions(Beforevaobj,cnt,TempVar)
  {
	     //Beforevaobj.onkeypress=function(){return(CheckFloatKey(event));}
       Beforevaobj.onchange=function(){rowcount=cnt;
  		 calculatevat(document.getElementById('Vat' + cnt),document.getElementById('Reason' + cnt),Beforevaobj,document.getElementById('ServiceFeePercent' +cnt),document.getElementById('VatAmount' + cnt),document.getElementById('ServiceFeeAmount' +cnt),document.getElementById('Total' + cnt),document.getElementById('AmtIncVat' + cnt),TempVar);}			
  }
	
  function CalculateTotalDynamicFunctions1(vatobj,cnt)
  {
             vatobj.onchange=function(){rowcount=cnt;
				 ChangeVat(vatobj,document.getElementById('Reason' + cnt),document.getElementById('BeforeVat' + cnt),document.getElementById('ServiceFeePercent' +cnt),document.getElementById('VatAmount' + cnt),document.getElementById('ServiceFeeAmount' +cnt),document.getElementById('Total' + cnt),document.getElementById('AmtIncVat' + cnt));
  						//calculatevat(vatobj,document.getElementById('Reason' + cnt),document.getElementById('BeforeVat' + cnt),document.getElementById('ServiceFeePercent' +cnt),document.getElementById('VatAmount' + cnt),document.getElementById('ServiceFeeAmount' +cnt),document.getElementById('Total' + cnt));
  						}			
        	
  }
function CalculateTotalDynamicFunctions2(Serviceobj,cnt)
{
              Serviceobj.onchange=function(){rowcount=cnt;
						calculatevat(document.getElementById('Vat' + cnt),document.getElementById('Reason' + cnt),document.getElementById('BeforeVat' + cnt),Serviceobj,document.getElementById('VatAmount' + cnt),document.getElementById('ServiceFeeAmount' +cnt),document.getElementById('Total' + cnt),document.getElementById('AmtIncVat' + cnt),0);}			
      	
}
function CalculateAmtIncDynamicFunctions2(AmtIncVatobj,cnt,TempVar)
{
	
              AmtIncVatobj.onchange=function(){
			
			  calculatevat(document.getElementById('Vat' + cnt),document.getElementById('Reason' + cnt),document.getElementById('BeforeVat' + cnt),document.getElementById('ServiceFeePercent' +cnt),document.getElementById('VatAmount' + cnt),document.getElementById('ServiceFeeAmount' +cnt),document.getElementById('Total' + cnt),AmtIncVatobj,TempVar);}	
						//calculateAmounts(AmtIncVatobj,document.getElementById('Vat' + cnt),document.getElementById('Beforevat' + cnt),document.getElementById('ServiceFeePercent' + cnt),document.getElementById('VatAmount' + cnt),document.getElementById('ServiceFeeAmount' +cnt),document.getElementById('Total' + cnt));}			
      	
}
function LicenseDynamicFunctions(fieldObj,buttonObj,rowCnt)
{
 				
				//fieldObj.onchange=function(){GetICode(document.getElementById("ICode"+rowCnt).value,rowCnt);}					
				buttonObj.onclick=function(){
				GetLNo(document.getElementById("LicenseNo"+rowCnt).value,rowCnt);}	
}

function ReasonDynamicFunctions(reasonobj1,cnt1)
{
 				
				reasonobj1.onchange=function(){rowcount=cnt1;
				reasonvatservice(document.getElementById('Vat' + cnt1),this,document.getElementById('BeforeVat' + cnt1),document.getElementById('ServiceFeePercent' + cnt1),document.getElementById('VatAmount' + cnt1),document.getElementById('ServiceFeeAmount' + cnt1),document.getElementById('Total' + cnt1),document.getElementById('ReasonPayvat' + cnt1),document.getElementById('ReasonPayservice' + cnt1),document.getElementById('AmtIncVat' + cnt1));					
				  ; if(document.forms[0].CompanyCode.value!=82){validateReason();}
				//(vatbobj1,reasonobj1,beforevatobj1,serviceobj1,vatamountobj1,servicamountobj1,totalobj1,reasonpayvatobj1,reasonpayserviceobj1)
}					
				
}




function GetLNo(LCodeCnt,cnt)
{
  with(document.forms[0])
	{

	NewWin('/Magic94Scripts/mgrqispi94.dll?appname=RentProWeb&prgName=FleetQuickAccess&Arguments=-A3','License','Ajustmentcreate','left=162,top=86,height=600,WIDTH=900,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no');
	
	}

}
var globalXML2 = getXMLParser();
	
	function UpdateItemXml()
{
	   with(document.forms[0])
        {
      			
           // globalXML2 = new ActiveXObject("Microsoft.XMLDOM");
            var xmlObj = getXMLFirstElement(globalXML2,"Root")
      			
      			tbl=document.getElementById("DetailsTable");
      	         rows=tbl.tBodies[0].rows;
      					 
      			for(i=1;i<rows.length;i++)
             
              { cells=rows[i].cells;	 
          			var rowid_var=rows[i].getAttribute("rowid");
                var Record=createElementCommon(xmlObj,globalXML2,'Details');
                
                newatt=createAttributeCommon(xmlObj,globalXML2,'Reason');
                newatt.value=document.getElementById("Reason"+rowid_var).value;
                Record.setAttributeNode(newatt);
                
                newatt=createAttributeCommon(xmlObj,globalXML2,'Remark');
                newatt.value=document.getElementById("Remark"+rowid_var).value;
                Record.setAttributeNode(newatt);
                
                newatt=createAttributeCommon(xmlObj,globalXML2,'BeforeVAT');
                newatt.value=document.getElementById("BeforeVat"+rowid_var).value;
                Record.setAttributeNode(newatt);
                
				newatt=createAttributeCommon(xmlObj,globalXML2,'ServiceFeePer');
                newatt.value=document.getElementById("ServiceFeePercent"+rowid_var).value;
                Record.setAttributeNode(newatt);
					
								
				newatt=createAttributeCommon(xmlObj,globalXML2,'VATPer');
                newatt.value=document.getElementById("Vat"+rowid_var).value;
                Record.setAttributeNode(newatt);
												
				appendNodeToParent(xmlObj,Record)
              }
				DetailLinesBlob.value = getXMLStringFromObject(xmlObj);
				return true;
					
			}		
	}
	
	function CheckFiscalPeriod(DateObj)
{
	with(document.forms[0])
	{
				 /* var urlOc = '/Magic94Scripts/mgrqispi94.dll?appname=RentProWeb&prgName=CommonXMLValidation&Arguments=-A355,-A'+DateObj.value;			
				  var xmltemp = new ActiveXObject("Msxml2.XMLHTTP.3.0");
				  xmltemp.open("GET",urlOc, false);			 
				  xmltemp.send();			
				  EmpExists = xmltemp.responseXML;*/
				 // alert(EmpExists.xml)
				 var urlOc = 'CommonXMLValidation&Arguments=-A355,-A'+DateObj.value;
						EmpExists =loadDefXml(urlOc)
				  resultNode = EmpExists.getElementsByTagName('Root').item(0);      
				  if(resultNode)
				  {			  
					  var Allowed = resultNode.getElementsByTagName('Allowed').item(0).text;
					  if(Allowed=='N')
					  {
							alert('Fiscal Period Is Undefined/Closed');
							return false;
					  }
				  }
		}
		return true;
}
<!----Dyanamic End-->


</script>
</head>

<body  onload="cursor();ChargeVatChauff('');STaxRentalComp();" leftmargin="0" topmargin="4">

<form action="/Magic94Scripts/mgrqispi94.dll" method="post">
<INPUT type="hidden" name="APPNAME" value="RentProWeb">
<INPUT type="hidden" name="PRGNAME" value="AdjustmentInvoiceProceed">
<input type="hidden" name="ARGUMENTS" value="OutBranch,AgreementNo,InvNo,Charge,LastName,FirstName,DriverCode,DebitorCode,Currency,outdate,-A,-A,-A,-A,-A,-A,-A,-A,-A,-A,-A,-A,-A,-A,-A,-A,InvoiceNo,Dispute,Remark,AddRemark,Adjtype,MasterContract,ProjectNo,fromdate,dateto,-A,-A,-A,-A,-A,DetailLinesBlob,CalledFrom,LicenseNo1,ProjectNo,QuotationNO,SerialNo,StanpDutyInv,AnalysisFeeInv,InvoiceLableVal,Cust_ContactId,-A,-A,RentalDepInv">

<input type="Hidden" name="UserId" value="<!$MG_UserId>">
<input type="Hidden" name="FlagInvoice" value="<!$MG_FlagInvoice>">
<input type="Hidden" name="RentalDepInv" value="<!$MG_RentalDepInv>">
<input type="Hidden" name="DebPayVat" value="<!$MG_DebPayVat>">
<input type="Hidden" name="DrvPayVat" value="<!$MG_DrvPayVat>">
<input type="Hidden" name="Vat%1" value="<!$MG_Vat%1>">
<input type="Hidden" name="ServiceFee" value="<!$MG_ServiceFee>">
<input type="Hidden" name="ServiceOnSaleTax" value="<!$MG_ServiceOnSaleTax>"><!-- For Caluating vat Before Or After Service Tax -->
<input type="Hidden" name="CreditCard" value="">
<input type="Hidden" name="DriverCode" value="<!$MG_DriverCode>">
<input type="hidden" name="AgrVat" value="<!$MG_AgrVat%>">
<input type="Hidden" name="AgrService" value="<!$MG_AgrService%>">
<input type="Hidden" name="DefaultService" value="<!$MG_DefService%>">
<input type="Hidden" name="ErrorWarningFlag" value="<!$MG_ErrorWarningFalg>">
<input type="Hidden" name="Resaon1Payvat" value="">
<input type="Hidden" name="Resaon2Payvat" value="">
<input type="Hidden" name="Resaon3Payvat" value="">
<input type="Hidden" name="Resaon4Payvat" value="">
<input type="Hidden" name="Resaon1Payservice" value="">
<input type="Hidden" name="Resaon2Payservice" value="">
<input type="Hidden" name="Resaon3Payservice" value="">
<input type="Hidden" name="Resaon4Payservice" value="">
<input type="Hidden" name="InvoiceCreated" value="">
<input type="Hidden" name="DecimalSeparator" value="<!$MG_DecimalSeparator>">
<input type="Hidden" name="Adjtype" value="<!$MG_AdjType>">
<input type="Hidden" name="ChargeVatYN" value="<!$MG_ChargeVatYN>">
<input type="Hidden" name="CompanyCode" value="<!$MG_CompanyCode>">
<input type="hidden" name="PassAuthYN" value="<!$MG_PassAuthYN>">
<input type="hidden" name="DetailLinesBlob" value="">
<input type="hidden" name="CalledFrom" value="1">
<input type="hidden" name="DecimalFormat" value="<!$MG_DecimalFormat1>">
<input type="Hidden" name="LicenseNo1" value="<!$MG_LicenseNo1>">
<input type="Hidden" name="StampDutyAmt" value="<!$MG_StampDutyAmt>"> 
<input type="Hidden" name="StanpDutyInv" value="<!$MG_StampDutyInv>">
<input type="Hidden" name="AnalysisFeeAmt" value="<!$MG_AnalysisFeeAmt>"> 
<input type="Hidden" name="AnalysisFeeInv" value="<!$MG_AnalysisFeeInv>">
<input type="Hidden" name="AnalysisFeeAdjReason" value="<!$MG_AnalysisFeeAdjReason>">
<input type="hidden" name="StampDutyInvoice" value="<!$MG_AllowStampDuty>">
<input type="Hidden" name="InvoiceLableVal" value="<!$MG_invoiceLableVal>">
<input type="Hidden" name="InvoiceType" value="<!$MG_InvoiceType>">
<input type="Hidden" name="InvSubType" value="<!$MG_InvSubType>">
<input type="Hidden" name="CurrDate" id="CurrDate" value="">
<input type="hidden" name="CSRFCode" id="CSRFCode" value="<!$MG_CSRFCode>">	 
<input type="hidden" name="CompanyFormat" id="CompanyFormat" value="<!$MG_CompanyFormat>">	 
<input type="hidden" name="CountryISOCOde" id="CountryISOCOde" value="<!$MG_CountryISOCOde>">	 
<select  name="DummyReasonCombo" id="DummyReasonCombo" style="display:none" >
  	<!$MGREPEAT>
<option value="<!$MG_Code>" ReasonpayVat="<!$MG_ReasonPayVat>" Reasonpayservice="<!$MG_ReasonPayService>"><!$MG_text></option>
  <!$MGENDREPEAT>
</select>
<TABLE border=0 cellPadding=0 cellSpacing=0 width="845">  
<tr>
    <td valign="top" class="LeftCorner">&nbsp;&nbsp;&nbsp;&nbsp;</td>
    <td width="100%" valign="middle" class="MainHeader" >&nbsp;&nbsp;Adjustment Invoice</td>
    <td valign="middle" class="MainHeader" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
    <td valign="top" class="LeftBorder"><!--DWLayoutEmptyCell-->&nbsp;</td>				
    <td width="100%">
    <table class="Tablebox" width="100%" border=0 cellPadding=0 cellSpacing=0 ><!--(MAIN) TABLE-2 STARTING-->
    <tr>
        <td>
        <table border=1 cellspacing=2 cellpadding=2 width="100%" class="box"> 
				<col width="15%"></col>  
				<col width="50%"></col>  
				<col width="15%"></col>  
				<col width="20%"></col>  
        <tr >
            <td >Branch</td>
           	<td> 
        		<input type="text" name="OutBranch" class="readOnly_textInputFieldLr" readonly value="<!$MG_DefaultBranCode>"  maxlength="10">
        		<INPUT type='text' name="BranchName" class="readOnly_textInputFieldLG" style="width:250px"  readonly value="<!$MG_DefaultBranchName>" tabindex=-1>
        		</td>
        		<td >Date</td>
            <td><input type="text" name="outdate" class="readOnly_textInputFieldLr" readonly maxlength="10"   value="<!$MG_Date>" tabindex=-1></td>
        </tr>
        <tr >
            <td >Currency</td>
        		<td><input type="text" name="Currency" class="readOnly_textInputFieldLr" readonly size="10" maxlength="10"   value="<!$MG_Currency>" tabindex=-1></td>
        		<td >Dispute</td>
           	<td><input type="text" name="Dispute" class="readOnly_textInputFieldLr" value="<!$MG_DisputeNo>" size="10" maxlength="10" tabindex=-1> </td>
            
        </tr>
        <tr >
            <td >Adjustment Type</td>
        		<td><input type="text" name="AdjTypeDes" class="readOnly_textInputFieldLr" readonly size="10" maxlength="10"   value="<!$MG_AdjTypeDes>" tabindex=-1></td>
        		<td >Master Contract</td>
           	<td><input type="text" name="MasterContract" class="readOnly_textInputFieldLr" value="<!$MG_MasterContract>" size="10" maxlength="10" tabindex=-1> </td>
            
        </tr>
        <tr >
            <td >Agreement</td>
            <td><input type="text" name="AgreementNo" class="readOnly_textInputFieldLr" readonly value="<!$MG_AgreementNo>" size="10" maxlength="10" tabindex=-1></td>
        		<td >Invoice</td>
            <td><input type="text" name="InvNo" class="readOnly_textInputFieldLr" readonly value="<!$MG_InvoiceNo>" size="12" maxlength="10" tabindex=-1></td>
        </tr>
		 <tr id="quotRow"> 
            <td >Quotation No</td> 
            <td><input type="text" name="QuotationNO" class="readOnly_textInputFieldLr" readonly value="<!$MG_QuotationNo>" size="10" maxlength="10" tabindex=-1></td>
        		<td >Serial No</td>
            <td><input type="text" name="SerialNo" class="readOnly_textInputFieldLr" readonly value="<!$MG_SerialNo>" size="12" maxlength="10" tabindex=-1></td>
        </tr>
		<tr id="stampDutyRow">
            <td >Stamp Duty Invoice</td>
            <td ><input type="text" name="StampDutyYN" class="readOnly_textInputFieldLr" readonly value="<!$MG_stmpDutyYN>" size="10" maxlength="10" tabindex=-1></td>
			<td >Stamp Duty Amount</td>
            <td ><input type="text" name="StampDutyAmt1" class="readOnly_textInputFieldLr" readonly value="<!$MG_stmpDuty>" size="10" maxlength="10" tabindex=-1></td>
        </tr>
				<tr id="analysisFeeRow">
            <td >Analysis Fee Invoice</td>
            <td ><input type="text" name="AnalysisFeeYN" class="readOnly_textInputFieldLr" readonly value="<!$MG_analysisFeeYN>" size="10" maxlength="10" tabindex=-1></td>
			<td >Analysis Fee Amount</td>
            <td ><input type="text" name="AnalysisFeeAmt1" class="readOnly_textInputFieldLr" readonly value="<!$MG_analysisFee>" size="10" maxlength="10" tabindex=-1></td>
        </tr>
        <tr >
            <td >Charge</td>
        		<td><input type="text" name="Charge" class="readOnly_textInputFieldLr" readonly size="10" maxlength="10"   value="<!$MG_Charge>" tabindex=-1></td>
        <td>License </td>
			<td><input type="text" name="LicenseNO1" class="readOnly_textInputFieldLr" readonly value="<!$MG_LicenseNo1>" size="12" maxlength="10" tabindex=-1></td>
		
				</tr>
        <tr >
            <td >Customer</td>
            <td>
						<input type="text" name="DebitorCode" value="<!$MG_DebitorCode>" readonly class="readOnly_textInputFieldLr" readonly size="10" maxlength="5" tabindex=-1>
        		<input type="text" name="DebitorName" value="<!$MG_DebitorName>" readonly size="30" maxlength="20" style="width:250px" readonly class="readOnly_textInputFieldLr" tabindex="-1" tabindex=-1>
						</td>

<td >Project No</td>
            <td><input type="text" name="ProjectNo" class="readOnly_textInputFieldLr" readonly value="<!$MG_ProjectNo1>" size="10" maxlength="10" tabindex=-1></td>
        </tr>
        <tr>
            <td>Driver Name</td>
            <td><input type="text" name="LastName" value="<!$MG_LastName>" size="30" maxlength="25" readonly class="readOnly_textInputFieldLr" tabindex="-1">
        		<input type="text" name="FirstName" value="<!$MG_FirstName>" size="20" maxlength="20" style="width:250px" readonly class="readOnly_textInputFieldLr" tabindex=-1>
			</td>
			
			<td id="RentalDepInv_Theeb" style="display:none">Rental Deposit Invoice</td>
				<td  id="RentalDepInv_Theeb"><input type=checkbox disabled name="RentalDepInvVal" id="RentalDepInvVal" /></td>
			
			<td id="invLable" style="display:none" colspan=2>
			<input type="checkbox" disabled name="InvoiceLable"/> &nbsp;Invoice Label
				</td>
				<td id="invOthLable" style="display:none" colspan=2></td>
        </tr>
		<tr <!$MGIF_AllowCustConst> <!$MGELSE>style="display:none"<!$MGENDIF>>
		<td>Customer Contact Person</td>
			<td colspan="3"><input type="text" name="Cust_Contact" id="Cust_Contact" style="width:180px" value="<!$MG_Contact_person>"  readOnly class="readOnly_textInputFieldLG"/>	
			<input type="hidden" name="Cust_ContactId" id="Cust_ContactId" readOnly style="width:150px" value="<!$MG_Cust_ContactId>" class="readOnly_textInputFieldLG"/>
		</tr>
			<tr <!$MGIF_AllowProcessingFee> <!$MGELSE>style="display:none"<!$MGENDIF>>
		<td>Processing Fee</td>
			<td colspan="3"><input type="text" name="Process_Fee" id="Process_Fee" style="width:180px" value="<!$MG_Processing_Fee>"  readOnly class="readOnly_textInputFieldLG"/>	
				</tr>
				<tr>
				    <td >From Date</td>
            <td><input type="text" name="fromdate" class="readOnly_textInputFieldLr" readonly maxlength="10"   value="<!$MG_FromDate>" tabindex=-1></td>
				    <td >To Date</td>
            <td><input type="text" name="dateto" class="readOnly_textInputFieldLr" readonly maxlength="10"   value="<!$MG_ToDate>" tabindex=-1></td>
				</tr>		
        <tr>
            <td  >Remark</td>
            <td colspan="3"><input type="text" name="Remark" value="<!$MG_Remark>" size="80" maxlength="80" readonly  style="width:550px"   class="readOnly_textInputFieldLr" tabindex="-1">
        </tr>
        <tr>
            <td  ><!$MGIF_NOTZubair>Additional Remark<!$MGELSE>LPO No.<!$MGENDIF></td>
            <td colspan="3"><input type="text" name="AddRemark" value="<!$MG_AddRemark>" size="80" <!$MGIF_NOTZubairUcr>maxlength="80" <!$MGELSE><!$MGIF_forucr>maxlength="250"<!$MGELSE>maxlength="15" <!$MGENDIF><!$MGENDIF> readonly   <!$MGIF_NOTZubair>style="width:550px" <!$MGELSE>style="width:150px" <!$MGENDIF>   class="readOnly_textInputFieldLr" tabindex="-1"></td>
            
        </tr>
        </table>
        </td>
    </tr>
    <tr>
        <td >
        <div id='s2' style="overflow: auto; height: 140;border-color:none; padding:0px; margin: 0px ;background-color:#efefef;" >
	          <Table border="1" width="100%" class="sortable" id="DetailsTable" bordercolor="#bebebc" >
							                   
					<TR valign="top" style="height:15px;">
							                       
					   <TH bgcolor="#dededc" >&nbsp;</TH>								
	                <th >Reason</th>
					  
      				<th >Remark</th>
					 <th id="Theeb1">Amt Incl.VAT</th>
                  <th >Before VAT</th>
                  <th >Service Fee %</th>
                  <th >Service Fee</th>
                  <th >VAT %</th>
                  <th >VAT Amount</th>
                  <th >Total</th>
                    <TH bgcolor="#dededc">  </TH>
																															
				  </TR>
					<tbody></tbody>												
		
							                    
					  </table>
			</div>
														
        </td>
    </tr>
		<tr>
				<td >
				
				<Table border="1" width="100%" class="Tablebox"  bordercolor="#bebebc" >
				<tr>
				<td align="left" colspan="2" width="17%">
					 <input type="button" id="Add" name="Add" value="Add" onclick="javascript:AddNew();"class="buttonMdTp3" >
														      
						</td>
						 <td  width="12%">Total</td>
						
            <td width="12%"><input type="text" name="TotalBeforeVat" size="10" maxlength="10" tabindex="-1" readonly class="readOnly_textInputFieldMd" value="0"></td>
            <td width="14%">&nbsp;&nbsp;</td>
            <td width="12%"><input type="text" name="TotalService" size="10" maxlength="10" tabindex="-1" readonly class="readOnly_textInputFieldMd" value="0"></td>
            <td width="8%">&nbsp;&nbsp;</td>
            <td width="13%"><input type="text" name="TotalVat" size="10" maxlength="10" tabindex="-1" readonly class="readOnly_textInputFieldMd" value="0"></td>
            <td><input type="text" name="TotalAmount" size="10" maxlength="10" tabindex="-1"readonly class="readOnly_textInputFieldMd" value="0"></td>
        </tr>
					 </table>
						</tr>
		<tr>
        <td>
        <table  cellspacing="2" cellpadding="2" width="100%" border="1" class="box">
        <tr>
            <td align="right">
                <INPUT TYPE="button" class="buttonMdTp3" name="Back_Bt" id="Back_Bt" value="Back" onclick="javascript:history.go(-1)">
                <INPUT TYPE="button" class="buttonmdTp3" name="Proceed_BT" value="Proceed" disabled onclick="javascript:check_form()" >
                <INPUT type="button" class="buttonMdTp3" name="Clear_BT" value="Clear" onclick="ClearData()">
                <!--
                <INPUT TYPE="button" NAME="Payment_BT" value="Payment" onclick="Payment()">
                <INPUT TYPE="button" NAME="Print_BT" value="Print Invoice" onclick="PrintDoc()">
                //-->
            </td>
        </tr>
        </table>
        </td>
    </tr>
    </table>
    </td>
    <td valign="top" class="RightBorder"></td>							
</tr>
<tr>
    <td valign="top" class="BottomLeftCorner"></td>
    <td valign="top" class="BottomBorder"><!--DWLayoutEmptyCell--></td>
    <td valign="top" class="BottomRightCorner"></td>      
</tr>
</TABLE>                        
<IFRAME src="blank.htm" name="frm_page" id="frm_page" width="0" height="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0"></IFRAME>
</form>
</body>
</html>
